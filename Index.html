<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profkom Card</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }
        body.dark {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        body.dark .bg-white {
            background-color: #2d3748;
        }
        body.dark .text-gray-800 {
            color: #e2e8f0;
        }
        body.dark .text-gray-600 {
            color: #a0aec0;
        }
        body.dark nav {
            background-color: #2d3748;
        }
        body.dark .card {
            background-color: #2d3748;
            color: #e2e8f0;
        }
        body.dark input, body.dark select {
            background-color: #4a5568;
            color: #e2e8f0;
        }
        body.dark button {
            background-color: #4a5568;
            color: #e2e8f0;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-gray-50 transition-colors duration-300">
    <div id="issueCardModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full m-4">
            <h3 class="text-xl font-bold mb-4 text-gray-800">Выпуск новой карты</h3>
            <form id="issueCardForm">
                <div class="mb-4">
                    <label for="firstName" class="block text-sm font-medium text-gray-700">Имя</label>
                    <input type="text" id="firstName" name="firstName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" required>
                </div>
                <div class="mb-4">
                    <label for="lastName" class="block text-sm font-medium text-gray-700">Фамилия</label>
                    <input type="text" id="lastName" name="lastName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" required>
                </div>
                <div class="mb-4">
                    <label for="faculty" class="block text-sm font-medium text-gray-700">Факультет</label>
                    <input type="text" id="faculty" name="faculty" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" required>
                </div>
                <div class="mb-4">
                    <label for="course" class="block text-sm font-medium text-gray-700">Курс</label>
                    <input type="number" id="course" name="course" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" required>
                </div>
                <div class="flex justify-end">
                    <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors">
                        Выпустить карту
                    </button>
                </div>
            </form>
        </div>
    </div>

    <header id="header" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 shadow-lg">
        <div class="flex justify-between items-center mb-2">
            <div class="flex items-center space-x-2">
                <button id="userInfoBtn" class="bg-white bg-opacity-20 p-2 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                </button>
                <div id="userName" class="text-lg font-semibold"></div>
            </div>
            <div class="flex items-center space-x-2">
                <div class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">
                    <span class="text-yellow-300">●</span>
                    <span id="pointsDisplay" class="font-bold">1000</span>
                </div>
            </div>
        </div>
        <div class="flex justify-center items-center space-x-2 mt-2">
            <img src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/pelican-jRFLEQsJRDgrbDNnfTFsKgsFFbjXNE.png" alt="Profkom Card Logo" width="30" height="30">
            <div class="text-2xl font-bold">Profkom Card</div>
        </div>
    </header>

    <main id="mainContent" class="container mx-auto max-w-md flex-grow p-4">
        <!-- Content will be dynamically inserted here -->
    </main>

    <nav class="bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 p-2 flex justify-around shadow-lg">
        <button class="flex flex-col items-center transition-colors p-2 rounded-lg" data-section="main">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-home"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            <span class="text-xs mt-1 capitalize">Главная</span>
        </button>
        <button class="flex flex-col items-center transition-colors p-2 rounded-lg" data-section="promotions">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-ticket"><path d="M3 7v2a3 3 0 1 1 0 6v2c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-2a3 3 0 1 1 0-6V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2Z"/><path d="M13 5v2"/><path d="M13 17v2"/><path d="M13 11v2"/></svg>
            <span class="text-xs mt-1 capitalize">Акции</span>
        </button>
        <button class="flex flex-col items-center transition-colors p-2 rounded-lg" data-section="discounts">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag"><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"/><path d="M7 7h.01"/></svg>
            <span class="text-xs mt-1 capitalize">Скидки</span>
        </button>
        <button class="flex flex-col items-center transition-colors p-2 rounded-lg" data-section="minigames">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-gamepad-2"><line x1="6" x2="10" y1="11" y2="11"/><line x1="8" x2="8" y1="9" y2="13"/><line x1="15" x2="15.01" y1="12" y2="12"/><line x1="18" x2="18.01" y1="10" y2="10"/><path d="M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z"/></svg>
            <span class="text-xs mt-1 capitalize">Мини-игры</span>
        </button>
    </nav>

    <button id="darkModeToggle" class="fixed bottom-20 right-4 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 p-2 rounded-full shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
    </button>

    <button id="notificationBtn" class="fixed bottom-20 left-4 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 p-2 rounded-full shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bell"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>
    </button>

    <div id="rewardNotification" class="fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-green-400 to-blue-500 text-white px-6 py-3 rounded-full shadow-lg text-sm font-semibold hidden">
        +100 баллов за ежедневный чек-ин!
    </div>

    <div id="notification" class="fixed top-4 left-4 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-lg shadow-lg text-sm hidden"></div>

    <button id="dailyGift" class="fixed bg-yellow-400 text-yellow-900 p-3 rounded-full shadow-lg hidden">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-gift"><polyline points="20 12 20 22 4 22 4 12"/><rect width="20" height="5" x="2" y="7"/><line x1="12" x2="12" y1="22" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>
    </button>

    <div id="userInfo" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-sm w-full m-4">
            <h3 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-200">Информация о пользователе</h3>
            <p id="userInfoName" class="text-gray-600 dark:text-gray-400 mb-2"></p>
            <p id="userInfoFaculty" class="text-gray-600 dark:text-gray-400 mb-2"></p>
            <p id="userInfoCourse" class="text-gray-600 dark:text-gray-400 mb-2"></p>
            <button id="closeUserInfo" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-full hover:bg-blue-600 transition-colors">
                Закрыть
            </button>
        </div>
    </div>

    <script>
        // State
        let points = 1000;
        let isDarkMode = false;
        let activeSection = 'main';
        let lastCheckIn = null;
        let themeToggleCount = 0;
        let headerClickCount = 0;
        let headerGameCompleted = false;
        let themeGameCompleted = false;
        let qrProgress = 0;
        let qrGameCompleted = false;
        let lastQRGameDate = null;
        let cardNumber = 138;
        let userData = null;

        // DOM Elements
        const mainContent = document.getElementById('mainContent');
        const pointsDisplay = document.getElementById('pointsDisplay');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const notificationBtn = document.getElementById('notificationBtn');
        const rewardNotification = document.getElementById('rewardNotification');
        const notification = document.getElementById('notification');
        const dailyGift = document.getElementById('dailyGift');
        const userInfo = document.getElementById('userInfo');
        const closeUserInfo = document.getElementById('closeUserInfo');
        const issueCardModal = document.getElementById('issueCardModal');
        const issueCardForm = document.getElementById('issueCardForm');
        const header = document.getElementById('header');
        const userName = document.getElementById('userName');
        const userInfoName = document.getElementById('userInfoName');
        const userInfoFaculty = document.getElementById('userInfoFaculty');
        const userInfoCourse = document.getElementById('userInfoCourse');

        // Functions
        function updatePointsDisplay() {
            pointsDisplay.textContent = points;
        }

        function showNotification(message) {
            notification.textContent = message;
            notification.classList.remove('hidden');
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark', isDarkMode);
            updateDarkModeButton();
            localStorage.setItem('darkMode', isDarkMode);
            themeToggleCount++;
            if (themeToggleCount === 8 && !themeGameCompleted) {
                themeGameCompleted = true;
                points += 100;
                updatePointsDisplay();
                showNotification('Вы разгадали секрет темы! +100 баллов!');
            }
        }

        function updateDarkModeButton() {
            darkModeToggle.innerHTML = isDarkMode
                ? '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>'
                : '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>';
        }

        function showRandomNotification() {
            const notifications = [
                'Новая акция доступна!',
                'У вас есть неиспользованные баллы',
                'Не забудьте про ежедневный чек-ин'
            ];
            const randomNotification = notifications[Math.floor(Math.random() * notifications.length)];
            showNotification(randomNotification);
        }

        function handleDailyGift() {
            const reward = Math.floor(Math.random() * (250 - 50 + 1)) + 50;
            points += reward;
            updatePointsDisplay();
            dailyGift.classList.add('hidden');
            showNotification(`Вы получили ${reward} баллов!`);
        }

        function handleDailyCheckIn() {
            const today = new Date().toDateString();
            if (lastCheckIn !== today) {
                points += 100;
                updatePointsDisplay();
                lastCheckIn = today;
                rewardNotification.classList.remove('hidden');
                setTimeout(() => {
                    rewardNotification.classList.add('hidden');
                }, 3000);
            }
        }

        function handleQRTap(event) {
            const today = new Date().toDateString();
            if (qrGameCompleted || lastQRGameDate === today) return;

            const qrCode = document.getElementById('qrCode');
            const rect = qrCode.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            // Add new particle
            const particle = document.createElement('div');
            particle.className = 'absolute w-2 h-2 rounded-full';
            particle.style.left = `${x}px`;
            particle.style.top = `${y}px`;
            particle.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
            qrCode.appendChild(particle);

            // Animate particle
            setTimeout(() => {
                particle.style.transition = 'all 1s';
                particle.style.opacity = '0';
                particle.style.transform = 'translateY(-50px) scale(0)';
            }, 0);

            setTimeout(() => {
                qrCode.removeChild(particle);
            }, 1000);

            // Increase progress
            qrProgress += 0.05;
            if (qrProgress >= 1) {
                qrGameCompleted = true;
                lastQRGameDate = today;
                points += 100;
                updatePointsDisplay();
                showNotification('Вы нашли секрет! +100 баллов!');
                qrCode.style.transition = 'all 0.5s';
                qrCode.style.backgroundColor = 'rgba(255, 255, 0, 0.5)';
                setTimeout(() => {
                    qrCode.style.backgroundColor = 'white';
                    qrProgress = 0;
                }, 3000);
            }
        }

        function handleHeaderClick() {
            if (headerGameCompleted) return;

            headerClickCount++;
            if (headerClickCount === 10) {
                headerGameCompleted = true;
                points += 100;
                updatePointsDisplay();
                showNotification('Вы нашли секретную игру в заголовке! +100 баллов!');
            }
        }

        function renderMainContent() {
            mainContent.innerHTML = `
                <div class="flex flex-col items-center space-y-6 p-4">
                    <div id="qrCodeContainer" class="relative bg-gradient-to-br from-blue-400 to-purple-500 p-4 rounded-2xl shadow-lg cursor-pointer">
                        <div id="qrCode" class="bg-white p-2 rounded-xl">
                            <!-- QR code will be generated here -->
                        </div>
                        <button id="hideQRBtn" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1.5 shadow-md hover:bg-red-600 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                        </button>
                    </div>
                    <button id="showQRBtn" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-3 rounded-full shadow-lg hover:shadow-xl transition-all text-sm font-semibold hidden">
                        Показать QR-код
                    </button>
                    <div class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600">№ ${cardNumber.toString().padStart(5, '0')}</div>
                    <div class="w-full space-y-4">
                        <h2 class="text-xl font-bold text-gray-800 dark:text-gray-200">Ближайшие события</h2>
                        <div class="space-y-3">
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-l-4 border-blue-500">
                                <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200">Концерт в парке</h3>
                                <p class="text-gray-600 dark:text-gray-400 text-sm mt-1">15 июня, 19:00</p>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-l-4 border-purple-500">
                                <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200">Мастер-класс по йоге</h3>
                                <p class="text-gray-600 dark:text-gray-400 text-sm mt-1">20 июня, 10:00</p>
                            </div>
                        </div>
                    </div>
                    <div class="w-full space-y-4">
                        <h2 class="text-xl font-bold text-gray-800 dark:text-gray-200">Новости</h2>
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-l-4 border-green-500">
                            <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200">Новая система лояльности</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mt-1">Мы обновили нашу систему начисления баллов. Теперь вы получаете еще больше преимуществ!</p>
                        </div>
                    </div>
                    <button id="dailyCheckInBtn" class="bg-gradient-to-r from-green-400 to-blue-500 text-white px-6 py-3 rounded-full shadow-lg hover:shadow-xl transition-all text-sm font-semibold">
                        Ежедневный чек-ин
                    </button>
                </div>
            `;
            const qrCodeContainer = document.getElementById('qrCodeContainer');
            const qrCode = document.getElementById('qrCode');
            const hideQRBtn = document.getElementById('hideQRBtn');
            const showQRBtn = document.getElementById('showQRBtn');

            // Generate QR code
            new QRCode(qrCode, {
                text: `https://profkom-card.com/user/${cardNumber}`,
                width: 180,
                height: 180
            });

            qrCode.addEventListener('click', handleQRTap);
            hideQRBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                qrCodeContainer.classList.add('hidden');
                showQRBtn.classList.remove('hidden');
            });
            showQRBtn.addEventListener('click', () => {
                qrCodeContainer.classList.remove('hidden');
                showQRBtn.classList.add('hidden');
            });
            document.getElementById('dailyCheckInBtn').addEventListener('click', handleDailyCheckIn);
        }

        function renderPromotions() {
            mainContent.innerHTML = `
                <div class="p-4 space-y-6">
                    <h2 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600">Акции</h2>
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-l-4 border-yellow-500">
                        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200">2 по цене 1</h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm mt-1">Купите один товар и получите второй бесплатно!</p>
                    </div>
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-l-4 border-pink-500">
                        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200">Счастливые часы</h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm mt-1">Скидка 20% на все товары с 15:00 до 17:00</p>
                    </div>
                </div>
            `;
        }

        function renderDiscounts() {
            mainContent.innerHTML = `
                <div class="p-4 space-y-6">
                    <h2 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600">Скидки</h2>
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-l-4 border-orange-500">
                        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200">Летняя распродажа</h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm mt-1">Скидки до 50% на летнюю коллекцию</p>
                    </div>
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-l-4 border-teal-500">
                        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200">Подарок ко дню рождения</h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm mt-1">Получите скидку 15% в ваш день рождения</p>
                    </div>
                </div>
            `;
        }

        function renderMiniGames() {
            mainContent.innerHTML = `
                <div class="p-4 space-y-6">
                    <h2 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600">Мини-игры</h2>
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-l-4 border-indigo-500">
                        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200">Угадай мелодию</h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm mt-1">Проверьте свои музыкальные знания и выиграйте дополнительные баллы!</p>
                        <button class="mt-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-4 py-2 rounded-full shadow-md hover:shadow-lg transition-all text-sm">Играть</button>
                    </div>
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg hover:shadow-xl transition-shadow border-l-4 border-red-500">
                        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200">Викторина дня</h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm mt-1">Ответьте на 5 вопросов и получите шанс выиграть призы!</p>
                        <button class="mt-3 bg-gradient-to-r from-red-500 to-pink-600 text-white px-4 py-2 rounded-full shadow-md hover:shadow-lg transition-all text-sm">Начать</button>
                    </div>
                </div>
            `;
        }

        function updateUserInfo() {
            if (userData) {
                userName.textContent = `${userData.firstName} ${userData.lastName}`;
                userInfoName.textContent = `Имя: ${userData.firstName} ${userData.lastName}`;
                userInfoFaculty.textContent = `Факультет: ${userData.faculty}`;
                userInfoCourse.textContent = `Курс: ${userData.course}`;
            }
        }

        function initTelegramMiniApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                const tgWebApp = window.Telegram.WebApp;
                tgWebApp.ready();
                const userId = tgWebApp.initDataUnsafe.user.id;
                checkUserAuth(userId);
            }
        }

        function checkUserAuth(userId) {
            const storedUserData = localStorage.getItem(`userData_${userId}`);
            if (storedUserData) {
                userData = JSON.parse(storedUserData);
                updateUserInfo();
                renderMainContent();
            } else {
                checkFirstVisit();
            }
        }

        function checkFirstVisit() {
            if (!localStorage.getItem('userData')) {
                issueCardModal.classList.remove('hidden');
            } else {
                renderMainContent();
            }
        }

        // Event Listeners
        darkModeToggle.addEventListener('click', toggleDarkMode);
        notificationBtn.addEventListener('click', showRandomNotification);
        dailyGift.addEventListener('click', handleDailyGift);
        closeUserInfo.addEventListener('click', () => userInfo.classList.add('hidden'));
        header.addEventListener('click', handleHeaderClick);

        document.querySelectorAll('nav button').forEach(button => {
            button.addEventListener('click', (e) => {
                activeSection = e.currentTarget.dataset.section;
                document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('bg-blue-100', 'dark:bg-blue-900'));
                e.currentTarget.classList.add('bg-blue-100', 'dark:bg-blue-900');
                switch(activeSection) {
                    case 'main':
                        renderMainContent();
                        break;
                    case 'promotions':
                        renderPromotions();
                        break;
                    case 'discounts':
                        renderDiscounts();
                        break;
                    case 'minigames':
                        renderMiniGames();
                        break;
                }
            });
        });

        issueCardForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(issueCardForm);
            userData = Object.fromEntries(formData);
            cardNumber++;
            const userId = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp.initDataUnsafe.user.id : 'default';
            localStorage.setItem(`userData_${userId}`, JSON.stringify(userData));
            localStorage.setItem('cardNumber', cardNumber);
            updateUserInfo();
            issueCardModal.classList.add('hidden');
            renderMainContent();
            showNotification('Ваша карта успешно выпущена!');
        });

        // Initial setup
        function init() {
            initTelegramMiniApp();
            updatePointsDisplay();

            // Show daily gift
            const lastOpenDate = localStorage.getItem('lastOpenDate');
            const today = new Date().toDateString();
            if (lastOpenDate !== today) {
                dailyGift.style.top = `${Math.random() * (window.innerHeight - 60)}px`;
                dailyGift.style.left = `${Math.random() * (window.innerWidth - 60)}px`;
                dailyGift.classList.remove('hidden');
                localStorage.setItem('lastOpenDate', today);
            }

            // Set initial dark mode
            const storedDarkMode = localStorage.getItem('darkMode');
            if (storedDarkMode === 'true') {
                toggleDarkMode();
            }
        }

        init();
    </script>
</body>
</html>